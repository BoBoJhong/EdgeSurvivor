# 軟體需求分析文件
## Software Requirements Specification (SRS)

**專案名稱**: EdgeSurvivor (邊緣人神器)  
**版本**: 1.0  
**文件日期**: 2025年10月14日  
**作者**: 開發團隊  

---

## 目錄

1. [簡介](#1-簡介)
2. [整體描述](#2-整體描述)
3. [系統功能需求](#3-系統功能需求)
4. [非功能需求](#4-非功能需求)
5. [外部介面需求](#5-外部介面需求)
6. [系統特性](#6-系統特性)
7. [其他需求](#7-其他需求)

---

## 1. 簡介

### 1.1 目的
本文件旨在完整描述 EdgeSurvivor 旅伴媒合平台的軟體需求規格，提供開發團隊、測試團隊及專案相關人員清晰的需求定義。

### 1.2 文件範圍
本文件涵蓋 EdgeSurvivor 系統的所有功能需求、非功能需求、系統約束及外部介面需求。

### 1.3 預期讀者
- 軟體開發工程師
- 系統測試工程師
- 專案經理
- 產品經理
- 使用者體驗設計師

### 1.4 參考文件
- 專案管理規劃文件 (SPMP)
- 軟體設計文件 (SDD)
- 物件設計文件 (ODD)
- Task.md (專案需求定義)

---

## 2. 整體描述

### 2.1 產品觀點
EdgeSurvivor 是一個旅伴媒合平台，旨在解決單獨旅行者尋找志同道合旅伴的困難。系統提供活動建立、參與申請、智能媒合、即時聊天、活動管理及費用分攤等功能。

**系統定位**:
- B2C 網路服務平台
- 社交媒合應用
- 旅行規劃輔助工具

### 2.2 產品功能
-  **使用者管理**: 註冊、登入、個人資料管理
-  **活動管理**: 建立、搜尋、參與、管理旅伴活動
-  **媒合系統**: 智能配對旅伴，建立連結
-  **即時通訊**: Socket.IO 實現的聊天室
-  **討論串**: 活動參與者交流平台
-  **相簿功能**: 活動照片上傳與分享
-  **費用分攤**: 自動計算最佳結算方案

### 2.3 使用者特性

| 使用者類型 | 描述 | 技術能力 |
|-----------|------|----------|
| 一般用戶 | 尋找旅伴、參與活動的使用者 | 基礎網路使用能力 |
| 活動創建者 | 發起活動並管理參與者 | 中等網路使用能力 |
| 系統管理員 | 管理平台、處理異常 | 高技術能力 |

### 2.4 運行環境

**客戶端**:
- 支援瀏覽器: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 響應式設計: 支援桌面、平板、手機

**伺服器端**:
- 作業系統: Linux (Ubuntu 20.04+) / Windows Server
- Python 版本: 3.9+
- 資料庫: MySQL 8.0+ / MariaDB 10.6+
- Web 伺服器: Nginx / Apache
- 容器化: Docker + Docker Compose

### 2.5 設計與實作約束

**技術約束**:
- 前端框架: Vue 3 (Composition API)
- UI 框架: Element Plus
- 後端框架: Flask (Python)
- ORM: SQLAlchemy 2.x
- 認證機制: JWT (JSON Web Token)
- 即時通訊: Socket.IO
- 資料庫: MySQL/MariaDB (關聯式資料庫)

**業務約束**:
- 使用者必須年滿 18 歲
- 所有活動必須由註冊用戶建立
- 媒合需雙方同意才能開啟聊天室
- 圖片上傳大小限制 5MB

### 2.6 假設與依賴

**假設**:
- 使用者擁有穩定的網路連線
- 使用者提供真實的個人資訊
- 伺服器 24/7 運行

**依賴**:
- MySQL/MariaDB 資料庫服務
- Socket.IO 即時通訊服務
- 圖片儲存空間 (本地或雲端)

---

## 3. 系統功能需求

### 3.1 使用者管理模組

#### FR-1.1 使用者註冊
**描述**: 新使用者可透過電子郵件註冊帳號

**優先級**:  高

**輸入**:
- 姓名 (必填, 2-50 字元)
- 電子郵件 (必填, 符合 Email 格式, 唯一)
- 密碼 (必填, 最少 8 字元, 需包含英文+數字)
- 確認密碼 (必填, 需與密碼一致)

**處理**:
1. 驗證輸入格式
2. 檢查 Email 是否已存在
3. 密碼進行 Hash 加密 (bcrypt)
4. 建立使用者記錄
5. 發送歡迎訊息 (選用)

**輸出**:
- 成功: 返回 201 Created, 導向登入頁面
- 失敗: 返回錯誤訊息 (Email 已存在、密碼格式錯誤等)

**測試案例**:
```
TC-1.1.1: 正常註冊流程
輸入: 有效的姓名、Email、密碼
預期: 成功建立帳號，可以登入

TC-1.1.2: Email 重複
輸入: 已存在的 Email
預期: 顯示 "此 Email 已被註冊"

TC-1.1.3: 密碼格式錯誤
輸入: 少於 8 字元的密碼
預期: 顯示 "密碼至少需要 8 個字元"
```

---

#### FR-1.2 使用者登入
**描述**: 使用者透過 Email 和密碼登入系統

**優先級**:  高

**輸入**:
- 電子郵件 (必填)
- 密碼 (必填)

**處理**:
1. 驗證 Email 是否存在
2. 驗證密碼是否正確
3. 生成 JWT Access Token (有效期 24 小時)
4. 生成 JWT Refresh Token (有效期 7 天)
5. 更新 last_seen 時間戳

**輸出**:
- 成功: 返回 JWT Token, 使用者資訊, 導向 Dashboard
- 失敗: 返回 401 Unauthorized, 錯誤訊息

**安全要求**:
- 連續登入失敗 5 次後鎖定帳號 10 分鐘
- 密碼傳輸使用 HTTPS 加密
- Token 儲存在 HttpOnly Cookie

---

#### FR-1.3 個人資料管理
**描述**: 使用者可查看和編輯個人資料

**優先級**:  中

**可編輯欄位**:
- 姓名
- 性別 (男/女/其他)
- 年齡 (18-100)
- 地區 (國家 - 城市)
- 個人簡介 (最多 500 字元)
- 興趣標籤 (多選)
- 頭像 (圖片上傳, 最大 5MB)

**不可編輯欄位**:
- 電子郵件 (需另外驗證流程)
- 註冊日期
- 使用者 ID

**處理**:
1. 驗證輸入格式
2. 檢查年齡範圍 (18-100)
3. 圖片上傳驗證 (格式、大小)
4. 更新資料庫記錄
5. 返回更新後的資料

---

#### FR-1.4 隱私設定
**描述**: 使用者可設定個人資料的可見性

**優先級**:  中低

**設定選項**:
- 個人資料可見性: 公開 / 部分公開 / 隱藏
- 顯示年齡: 是 / 否
- 顯示地區: 是 / 否
- 允許陌生人訊息: 是 / 否

---

### 3.2 活動管理模組

#### FR-2.1 建立活動
**描述**: 使用者可建立新的旅伴活動

**優先級**:  高

**輸入**:
- 活動標題 (必填, 5-100 字元)
- 活動日期 (必填, 未來日期)
- 開始時間 (選填)
- 活動地點 (必填)
- 活動描述 (必填, 最少 20 字元)
- 活動分類 (必填): 冒險、文化、休閒、運動、美食
- 最大參與人數 (必填, 2-50 人)
- 預估費用 (選填)
- 活動時長 (選填, 小時)
- 封面圖片 (選填, 最大 5MB)

**處理**:
1. 驗證輸入格式
2. 檢查日期是否為未來日期
3. 上傳封面圖片 (如有)
4. 建立活動記錄 (status = 'open')
5. 自動將創建者加入為參與者 (role = 'creator')

**輸出**:
- 成功: 返回活動 ID, 導向活動詳細頁面
- 失敗: 返回錯誤訊息

---

#### FR-2.2 搜尋與篩選活動
**描述**: 使用者可根據條件搜尋活動

**優先級**:  高

**篩選條件**:
- 關鍵字搜尋 (標題、描述)
- 活動日期範圍
- 活動地點
- 活動分類
- 參與者性別
- 費用範圍
- 活動狀態 (開放中/進行中/已完成)

**排序選項**:
- 最新建立
- 日期近到遠
- 費用低到高
- 參與人數

**處理**:
1. 解析查詢參數
2. 建構 SQL 查詢 (WHERE + ORDER BY)
3. 執行分頁查詢 (每頁 12 個活動)
4. 返回活動列表 + 總數

**輸出**:
```json
{
  "activities": [...],
  "total": 156,
  "page": 1,
  "per_page": 12,
  "total_pages": 13
}
```

---

#### FR-2.3 活動詳細頁面
**描述**: 顯示活動的完整資訊

**優先級**:  高

**顯示內容**:
- 活動基本資訊 (標題、日期、地點、描述)
- 創建者資訊 (頭像、姓名、簡介)
- 參與者列表 (頭像、姓名)
- 參與人數 / 最大人數
- 活動分類與標籤
- 封面圖片
- 活動狀態

**互動功能**:
- 申請參與按鈕 (未參與時)
- 取消申請按鈕 (已申請但未批准)
- 進入討論串 (已參與)
- 查看相簿 (已參與)
- 編輯活動 (創建者)
- 參與者管理 (創建者)

---

#### FR-2.4 申請參與活動
**描述**: 使用者可申請參與感興趣的活動

**優先級**:  高

**前置條件**:
- 使用者已登入
- 活動狀態為 'open'
- 參與人數未達上限
- 使用者尚未參與此活動

**輸入**:
- 申請訊息 (選填, 最多 200 字元)

**處理**:
1. 檢查前置條件
2. 建立參與記錄 (status = 'pending')
3. 通知活動創建者 (選用)

**輸出**:
- 成功: 顯示 "申請已送出，等待創建者審核"
- 失敗: 顯示錯誤原因

---

#### FR-2.5 審核參與申請
**描述**: 活動創建者可審核參與申請

**優先級**:  高

**權限**: 僅活動創建者

**操作選項**:
- 接受申請 (status: pending  approved)
- 拒絕申請 (status: pending  rejected, 需填寫原因)

**處理**:
1. 驗證操作者為創建者
2. 更新參與記錄狀態
3. 記錄時間戳 (approved_at / rejected_at)
4. 通知申請者 (選用)

---

#### FR-2.6 活動討論串
**描述**: 參與者可在活動討論串中交流

**優先級**:  中

**權限**: 僅已批准的參與者

**功能**:
- 發送文字訊息
- 查看歷史訊息
- 即時更新 (Socket.IO)
- 系統公告訊息 (新成員加入、活動更新)

**訊息類型**:
- text: 一般文字訊息
- image: 圖片訊息
- announcement: 系統公告

---

#### FR-2.7 活動相簿
**描述**: 參與者可上傳和查看活動照片

**優先級**:  中低

**權限**: 僅已批准的參與者

**功能**:
- 上傳照片 (最大 5MB, 支援 JPG/PNG)
- 查看所有照片 (Grid 佈局)
- 刪除自己上傳的照片
- 點擊放大預覽

**處理**:
1. 驗證使用者權限
2. 驗證圖片格式和大小
3. 儲存圖片到伺服器
4. 更新 activity.images JSON 陣列

---

### 3.3 媒合系統模組

#### FR-3.1 發送媒合申請
**描述**: 使用者可向其他使用者發送媒合申請

**優先級**:  高

**觸發情境**:
1. 從活動參與者列表
2. 從推薦媒合列表
3. 從使用者個人資料頁面

**輸入**:
- 目標使用者 ID (必填)
- 活動 ID (選填, 若從活動發起)
- 申請訊息 (選填, 最多 200 字元)

**處理**:
1. 檢查是否已存在媒合記錄
2. 建立媒合記錄 (status = 'pending')
3. user_a = 申請者, user_b = 接收者
4. 通知接收者 (選用)

**輸出**:
- 成功: 顯示 "媒合申請已送出"
- 失敗: "已存在媒合申請" 或其他錯誤

---

#### FR-3.2 回應媒合申請
**描述**: 使用者可接受或拒絕媒合申請

**優先級**:  高

**操作選項**:
- **接受**: status  'accepted', 開啟聊天室
- **拒絕**: status  'rejected'

**處理**:
1. 驗證接收者身份 (user_b)
2. 更新媒合狀態
3. 記錄時間戳
4. 若接受: 初始化聊天室
5. 通知申請者

---

#### FR-3.3 媒合列表
**描述**: 顯示所有媒合記錄

**優先級**:  中

**分頁標籤**:
- **推薦媒合**: 系統推薦的潛在旅伴 (興趣相似、地區相近)
- **待回應**: 收到的待處理申請 (status = 'pending', user_b = 當前使用者)
- **已發送**: 發出的申請 (user_a = 當前使用者)
- **已媒合**: 成功的媒合 (status = 'accepted')

**顯示資訊**:
- 對方頭像、姓名
- 共同活動 (如有)
- 興趣標籤
- 媒合狀態
- 申請時間

---

#### FR-3.4 取消/刪除媒合
**描述**: 使用者可取消或刪除媒合記錄

**優先級**:  中低

**操作情境**:
- 取消已發送的申請 (status = 'pending')
- 刪除已拒絕的記錄
- 解除已媒合的關係 (status  'cancelled')

**處理**:
1. 驗證操作權限
2. 更新狀態或刪除記錄
3. 若解除媒合: 關閉聊天室訪問

---

### 3.4 聊天系統模組

#### FR-4.1 開啟聊天室
**描述**: 已媒合的使用者可開啟聊天室

**優先級**:  高

**前置條件**:
- 兩位使用者已成功媒合 (status = 'accepted')

**處理**:
1. 驗證媒合狀態
2. 查詢歷史訊息
3. 建立 Socket.IO 連線
4. 進入聊天室 (room = match_id)

---

#### FR-4.2 發送訊息
**描述**: 使用者可發送文字訊息

**優先級**:  高

**輸入**:
- 訊息內容 (必填, 1-1000 字元)
- 訊息類型 (text/image/file)

**處理**:
1. 驗證使用者在聊天室中
2. 儲存訊息到資料庫
3. 透過 Socket.IO 即時推送給對方
4. 更新訊息狀態 (sent  delivered  read)

**即時通訊**:
- 使用 Socket.IO 'send_message' 事件
- 對方若在線: 立即推送
- 對方若離線: 下次上線時同步

---

#### FR-4.3 訊息已讀狀態
**描述**: 顯示訊息的已讀狀態

**優先級**:  中低

**狀態流轉**:
```
sent (已送出)  delivered (已送達)  read (已讀)
```

**處理**:
- 對方進入聊天室: sent  delivered
- 對方查看訊息: delivered  read
- 使用 Socket.IO 'mark_as_read' 事件

---

#### FR-4.4 未讀訊息提示
**描述**: 顯示未讀訊息數量

**優先級**:  中

**顯示位置**:
- 聊天列表的 Badge
- 導航列的訊息圖示

**計算邏輯**:
```sql
SELECT COUNT(*) FROM chat_messages
WHERE match_id IN (user_matches)
  AND sender_id != current_user_id
  AND status != 'read'
```

---

### 3.5 費用分攤模組

#### FR-5.1 新增費用
**描述**: 參與者可新增活動費用記錄

**優先級**:  中

**權限**: 已批准的參與者

**輸入**:
- 費用金額 (必填, > 0)
- 費用類別 (必填): 交通、住宿、餐飲、門票、其他
- 付款者 (必填, 從參與者選擇)
- 費用日期 (必填)
- 費用描述 (選填)

**處理**:
1. 驗證使用者權限
2. 建立費用記錄
3. 計算每人應分攤金額
4. 通知其他參與者 (選用)

---

#### FR-5.2 查看費用明細
**描述**: 顯示活動的所有費用記錄

**優先級**:  中

**顯示內容**:
- 費用列表 (日期、類別、金額、付款者、描述)
- 總費用
- 每人應付金額
- 個人已付金額

**排序**: 按日期降序

---

#### FR-5.3 費用結算
**描述**: 自動計算最佳結算方案

**優先級**:  中

**演算法**: 債務優化演算法
1. 計算每人的淨餘額 (已付 - 應付)
2. 將債權人和債務人配對
3. 計算最少交易次數的結算方案

**輸出範例**:
```
小明  小美: $150
小華  小明: $80
小強  小美: $120
```

**顯示**:
- 結算列表 (誰付誰多少)
- 總交易筆數
- 可複製結算結果

---

#### FR-5.4 刪除費用
**描述**: 刪除錯誤的費用記錄

**優先級**:  中低

**權限**:
- 費用新增者
- 活動創建者

**處理**:
1. 驗證操作權限
2. 刪除費用記錄
3. 重新計算結算方案

---

### 3.6 檔案上傳模組

#### FR-6.1 圖片上傳
**描述**: 支援頭像、封面、相簿圖片上傳

**優先級**:  高

**支援格式**: JPG, JPEG, PNG, GIF

**大小限制**: 5MB

**處理流程**:
1. 驗證檔案格式和大小
2. 生成唯一檔名 (UUID + 時間戳)
3. 儲存到 `/uploads` 目錄
4. 返回檔案 URL

**安全措施**:
- 檔案類型白名單驗證
- 檔案內容驗證 (防止偽裝)
- 限制上傳頻率 (Rate Limiting)

---

## 4. 非功能需求

### 4.1 效能需求

| 指標 | 要求 | 測量方式 |
|------|------|----------|
| API 回應時間 | < 500ms (95th percentile) | APM 監控 |
| 頁面載入時間 | < 3 秒 (首次載入) | Lighthouse |
| 並發使用者 | 支援 100+ 並發 | 壓力測試 (K6) |
| 資料庫查詢 | < 100ms (單次查詢) | Slow Query Log |
| 圖片上傳 | < 5 秒 (5MB 檔案) | 實際測試 |

### 4.2 可靠性需求

- **系統可用性**: 99% uptime (允許每月 ~7 小時停機)
- **資料備份**: 每日自動備份，保留 7 天
- **錯誤恢復**: 系統崩潰後 5 分鐘內自動重啟
- **資料一致性**: 使用 ACID 交易保證資料完整性

### 4.3 安全性需求

**認證與授權**:
- 使用 JWT Token 認證
- Token 有效期: Access Token 24h, Refresh Token 7d
- 密碼使用 bcrypt Hash (cost factor = 12)
- 實施 HTTPS 強制加密

**輸入驗證**:
- 所有使用者輸入進行驗證和清理
- 防止 SQL Injection (使用 ORM 參數化查詢)
- 防止 XSS 攻擊 (輸出轉義)
- 防止 CSRF 攻擊 (CSRF Token)

**API 安全**:
- Rate Limiting: 100 requests / 分鐘 / IP
- CORS 限制: 只允許授權的來源
- 敏感操作需二次驗證 (密碼變更、Email 變更)

### 4.4 可維護性需求

- **程式碼風格**: ESLint (前端), Flake8 (後端)
- **程式碼註解**: 關鍵業務邏輯需有註解
- **API 文件**: 使用 Swagger/OpenAPI 規範
- **錯誤日誌**: 使用 Python logging, 分級記錄
- **版本控制**: Git + Conventional Commits

### 4.5 可擴展性需求

- **水平擴展**: 支援多個 Web Server (無狀態設計)
- **資料庫擴展**: 支援讀寫分離、主從複製
- **快取策略**: Redis 快取熱門資料
- **CDN**: 靜態資源使用 CDN 加速

### 4.6 可用性需求

**響應式設計**:
- 支援桌面 (1920x1080+)
- 支援平板 (768x1024)
- 支援手機 (375x667+)

**無障礙設計**:
- 支援鍵盤導航
- 適當的 ARIA 標籤
- 色彩對比度符合 WCAG 2.1 AA 標準

**國際化** (第二階段):
- 支援繁體中文 (zh-TW)
- 支援英文 (en-US)

---

## 5. 外部介面需求

### 5.1 使用者介面

**設計原則**:
- Material Design 風格
- 簡潔直觀的導航
- 一致的視覺語言
- 清晰的錯誤提示

**主要頁面**:
1. 登入/註冊頁面
2. 首頁/儀表板
3. 活動列表頁面
4. 活動詳細頁面
5. 媒合頁面
6. 聊天室
7. 個人資料頁面
8. 設定頁面

### 5.2 硬體介面

**無特殊硬體需求**，標準電腦/手機即可。

### 5.3 軟體介面

**瀏覽器 API**:
- LocalStorage (Token 儲存)
- WebSocket (即時通訊)
- File API (圖片上傳)

**第三方服務** (選用):
- AWS S3 (圖片儲存)
- SendGrid (Email 通知)
- Google Analytics (使用者分析)

### 5.4 通訊介面

**HTTP/HTTPS**:
- RESTful API 設計
- JSON 格式資料交換
- Status Code 標準化

**WebSocket**:
- Socket.IO 協議
- 即時雙向通訊

---

## 6. 系統特性

### 6.1 智能推薦 (第二階段)
根據使用者興趣、地區、參與歷史推薦合適的活動和旅伴。

### 6.2 信任機制 (第二階段)
- 身份驗證徽章
- 評價與評分系統
- 完成活動次數統計

### 6.3 通知系統 (第二階段)
- Email 通知
- 瀏覽器推播通知
- 站內訊息中心

---

## 7. 其他需求

### 7.1 法律要求

- **隱私權政策**: 符合 GDPR / 個資法
- **使用條款**: 明確定義使用規範
- **未成年保護**: 禁止 18 歲以下使用者註冊

### 7.2 標準遵循

- **Web 標準**: HTML5, CSS3, ECMAScript 2020+
- **API 標準**: RESTful API 最佳實踐
- **安全標準**: OWASP Top 10

### 7.3 商業規則

- 免費使用基本功能
- 未來可能引入付費高級功能 (優先排序、更多媒合配額)

---

## 附錄 A: 使用案例圖

```
使用者
   註冊帳號
   登入系統
   編輯個人資料
   建立活動
   搜尋活動
   申請參與活動
   發送媒合申請
   回應媒合申請
   使用聊天室
   參與討論串
   上傳照片
   新增費用
   查看結算

活動創建者 (extends 使用者)
   審核參與申請
   管理參與者
   編輯活動資訊

系統管理員
   管理使用者
   管理活動
   查看系統日誌
```

---

## 附錄 B: 資料字典

詳見《物件設計文件》中的資料模型定義。

---

## 附錄 C: 變更歷史

| 版本 | 日期 | 作者 | 變更內容 |
|------|------|------|----------|
| 1.0 | 2025-10-14 | 開發團隊 | 初始版本 |

---

**文件結束**
